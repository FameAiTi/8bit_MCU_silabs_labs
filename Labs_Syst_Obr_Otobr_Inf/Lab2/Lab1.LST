C51 COMPILER V8.18   LAB1                                                                  03/13/2024 10:56:11 PAGE 1   


C51 COMPILER V8.18, COMPILATION OF MODULE LAB1
OBJECT MODULE PLACED IN Lab1.OBJ
COMPILER INVOKED BY: C:\SiLabs\MCU\IDEfiles\C51\BIN\C51.exe Lab1.c DB OE BR

line level    source

   1          #include "C8051F060.h"
   2          
   3          sbit a=P3^5;
   4          
   5          sbit b=P4^5;
   6          
   7          void PORT_sett (void);
   8          
   9          void work (void);
  10          
  11          void preobr (int);
  12          
  13          void TIM_sett (void);
  14          
  15          void delay (unsigned int del);
  16          
  17          int v[]={0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8, 0x10, 0x90};    // преобразуемые цифры
  18          
  19          int d[]={2, 1, 1, 1};                                     // вводите сюда данные
  20          
  21          int svet[]={0xDF, 0xBF, 0x7F, 0xEF};        //адреса индикаторов
  22          
  23          int i, p;
  24          
  25          //p - переменная в которой храниться преобразуемое значение
  26          
  27          //i - счетчик сегментных индикаторов
  28          
  29          void main (void)
  30          
  31          {        SFRPAGE = CONFIG_PAGE;
  32   1      
  33   1               EA=0;                                               //
  34   1      
  35   1               WDTCN = 0xDE;   // выключение watchdog timer
  36   1      
  37   1               WDTCN = 0xAD;                  
  38   1      
  39   1               EA=1;                                              
  40   1      
  41   1               OSCICN = 0x83;                     // Настройка f=24.5 MHz
  42   1      
  43   1               PORT_sett ();
  44   1      
  45   1               while(1)
  46   1      
  47   1               {work ();}
  48   1      
  49   1      }
  50          
  51          //настройка портов
  52          
  53          void PORT_sett (void)
  54          
  55          {
C51 COMPILER V8.18   LAB1                                                                  03/13/2024 10:56:11 PAGE 2   

  56   1      
  57   1               SFRPAGE = CONFIG_PAGE;  
  58   1      
  59   1               XBR2 = 0x40;      //включаю матрицу ввода - вывода
  60   1      
  61   1               P3MDOUT=0xFF;
  62   1      
  63   1               P4MDOUT=0xFF;
  64   1      
  65   1               P5MDOUT=0xFF;
  66   1      
  67   1               P7MDOUT=0xFF;                  //настройка портов Р3-Р5, Р7 на вывод       
  68   1      
  69   1      }
  70          
  71          //настрока таймера для формирования задержки
  72          
  73          void TIM_sett (void)
  74          
  75          {
  76   1      
  77   1               SFRPAGE  = TIMER01_PAGE;
  78   1      
  79   1               TMOD  |= 0x01;             //для формирования 1 мс
  80   1      
  81   1      }
  82          
  83          void work (void)
  84          
  85          {        i=0;
  86   1      
  87   1               while (i<4)
  88   1      
  89   1               {preobr (i);
  90   2      
  91   2      //----------------------------------------------------------
  92   2      
  93   2      //Цыфра горит
  94   2      
  95   2               a=1;                               //запрет работы дешифратора
  96   2      
  97   2               b=0;                               //запрет работы регистра DD12
  98   2      
  99   2               P5=p;                                      //горит цыфра
 100   2      
 101   2               P7=0xF8;                       // выбор светодиодов
 102   2      
 103   2               b=1;                    //Разрешение работы регистра DD12
 104   2      
 105   2               a=0;                      //Разрешение работы дешифратора
 106   2      
 107   2               a=1;                               //запрет работы дешифратора
 108   2      
 109   2               b=0;                               //запрет работы регистра DD12
 110   2      
 111   2               P5=svet[i];            //выбор индикатора
 112   2      
 113   2               P7=0xFD;
 114   2      
 115   2               b=1;           //Разрешение работы регистра DD12
 116   2      
 117   2               a=0;                      //Разрешение работы дешифратора
C51 COMPILER V8.18   LAB1                                                                  03/13/2024 10:56:11 PAGE 3   

 118   2      
 119   2               delay (250);           // формирование задержки
 120   2      
 121   2      //цифра не горит!!
 122   2      
 123   2               a=1;                               //запрет работы дешифратора
 124   2      
 125   2               b=0;                               //запрет работы регистра DD12
 126   2      
 127   2               P5=0xFF;                      //тушение светодиодов
 128   2      
 129   2               P7=0xF8;                       // выбор светодиодов
 130   2      
 131   2               b=1;           //Разрешение работы регистра DD12
 132   2      
 133   2               a=0;                      //Разрешение работы дешифратора
 134   2      
 135   2               a=1;                               //запрет работы дешифратора
 136   2      
 137   2               b=0;                               //запрет работы регистра DD12
 138   2      
 139   2               P5=svet[i];            //выбор индикатора
 140   2      
 141   2               P7=0xFD;
 142   2      
 143   2               b=1;           //Разрешение работы регистра DD12
 144   2      
 145   2               a=0;                      //Разрешение работы дешифратора
 146   2      
 147   2      //------------------------------------------------------------
 148   2      
 149   2               i++;}                              //следующий разряд    
 150   1      
 151   1      }
 152          
 153          void preobr (int current_cel)
 154          
 155          // ввод:p преобразуемый символ, вывод:p- код на семисегментнике
 156          
 157          {        int t;
 158   1      
 159   1               t=0;
 160   1      
 161   1               while (t<10)
 162   1      
 163   1               {        if (t==d[i])   // ищем что за цифра
 164   2      
 165   2                        {
 166   3                                                      if( i == 1)
 167   3                                                      {
 168   4                                                              p = v[t] & 0x7F;
 169   4                                                      }
 170   3                                                      else
 171   3                                                      {
 172   4                                                              p=v[t];
 173   4                                                      }                                               
 174   3      
 175   3                                                      
 176   3                                        }              // загрузка кода цифры
 177   2      
 178   2                         t++;
 179   2                       }
C51 COMPILER V8.18   LAB1                                                                  03/13/2024 10:56:11 PAGE 4   

 180   1      
 181   1      }
*** WARNING C280 IN LINE 153 OF LAB1.C: 'current_cel': unreferenced local variable
 182          
 183           
 184          
 185          //формирователь задержек
 186          
 187          void delay (unsigned int del)
 188          
 189          {        SFRPAGE  = TIMER01_PAGE;
 190   1      
 191   1               //для мс
 192   1      
 193   1               TH0 = 0xFE;
 194   1      
 195   1               TL0 = 0x0B;
 196   1      
 197   1               TR0=1;
 198   1      
 199   1               while (del!=0)
 200   1      
 201   1               {        while (!TF0){}
 202   2      
 203   2                         TH0 = 0xFE;
 204   2      
 205   2                         TL0 = 0x0B;
 206   2      
 207   2                         del--;
 208   2      
 209   2                         TF0=0;       }       
 210   1      
 211   1               TR0=0;
 212   1      
 213   1               SFRPAGE = CONFIG_PAGE;
 214   1      
 215   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    275    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     40       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
